{% block body %}
    <h2>Your Swear Jar</h2>
    <div id="swearJar">
        <h3>Swear Counts:</h3>
        <ul id="swearList">
            <!-- fill with swear words from database-->
        </ul>
        <p>Total Swears: 
            <span id="totalSwears">
                0
            </span>
        </p>
    </div>

    <button id="requestMicButton">Request Microphone Access</button>
    <button id="stop">Stop</button>

    <script>
        const requestMicButton = document.getElementById('requestMicButton');
        const stopButton = document.getElementById('stop');
        let mediaRecorder;
        let chunks = [];

        // Update swear jar
        async function updateSwearJar(){
            try{
                fetch('/api/swears').then(res => res.json()).then(console.log).catch(console.error);

                const response = await fetch('/api/swears');
                const data = await response.json();

                const swearList = document.getElementById('swearList');
                const totalSwears = document.getElementById('totalSwears');
                swearList.innerHTML = "";
                let total = 0;

                for(const[word, count] of Object.entries(data)){
                    const li = document.createElement('li');
                    li.textContent = `${word}: ${count}`;
                    swearList.appendChild(li);
                    total += count;
                }
                totalSwears.textContent = total;
            }catch(err){
                console.error('Error fetching swear counts:', err);
            }
        }

        // Call updateSwearJar on page load
        window.onload = updateSwearJar;

        // Event listener for requesting microphone access
        requestMicButton.addEventListener('click', async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                console.log('Microphone access granted:', stream);

                // Handle data available from the media recorder
                mediaRecorder.ondataavailable = (e) => {
                    chunks.push(e.data);
                };
                mediaRecorder.start();
                console.log(mediaRecorder.state);

            } catch (err) {
                console.error('Error accessing microphone:', err);
            }
        });

        // Event listener for stopping the recording
        stopButton.addEventListener('click', () => {
            if (mediaRecorder) {
                mediaRecorder.stop();
                console.log(mediaRecorder.state);
                // You can save or process the recorded data here
                console.log(mediaRecorder.mimeType);
            }
        });
    </script>
{% endblock %}
